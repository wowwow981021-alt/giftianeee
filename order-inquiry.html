<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ë‚´ ì£¼ë¬¸ì¡°íšŒ | ì´ì•ˆí‹°ì¼“</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    (function() {
      function forceExpand() {
        if (window.Telegram && window.Telegram.WebApp) {
          try {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
            if (window.Telegram.WebApp.viewportHeight) {
              window.Telegram.WebApp.expand();
            }
          } catch (e) {
            console.error('í…”ë ˆê·¸ë¨ WebApp í™•ì¥ ì˜¤ë¥˜:', e);
          }
        }
      }
      forceExpand();
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', forceExpand);
      }
      setTimeout(forceExpand, 100);
      setTimeout(forceExpand, 500);
      window.addEventListener('load', forceExpand);
    })();
  </script>
</head>
<body>

<header class="shop-header">
  <div class="header-container">
    <div class="header-left">
      <h1 class="shop-logo">ë‚´ ì£¼ë¬¸ì¡°íšŒ</h1>
    </div>
    <div class="header-right">
      <a href="index.html" class="cart-icon-link">
        <span class="cart-icon">ğŸ </span>
      </a>
    </div>
  </div>
</header>

<main class="main-content" style="padding: 20px;">
  <div class="inquiry-form-container">
    <h2>ê³ ê°ë‹˜ì˜ ì„±í•¨ê³¼<br>íœ´ëŒ€í° ë²ˆí˜¸ë¥¼<br>ì…ë ¥í•´ì£¼ì„¸ìš”.</h2>
    
    <form id="inquiryForm" onsubmit="searchOrders(event)">
      <div class="form-group">
        <label>ê³ ê°ëª…</label>
        <input type="text" id="customerName" class="form-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
      </div>

      <div class="form-group">
        <label>íœ´ëŒ€í° ë²ˆí˜¸</label>
        <input type="tel" id="customerPhone" class="form-input" placeholder="010-0000-0000" required>
      </div>

      <div class="form-submit">
        <button type="submit" class="btn-primary" style="width: 100%; padding: 18px; font-size: 1.2em;">
          ì¡°íšŒí•˜ê¸°
        </button>
      </div>
    </form>

    <p style="text-align: center; color: #666; margin-top: 20px; font-size: 0.9em;">
      ìµœê·¼ 1ë…„ì´ë‚´ì— ì‹ ì²­í•˜ì‹  ì£¼ë¬¸ì„ ì¡°íšŒí•˜ì‹¤ ìˆ˜ ìˆì–´ìš”
    </p>
  </div>

  <div id="orderResults" class="order-results" style="display: none;">
    <h3>ì£¼ë¬¸ ë‚´ì—­</h3>
    <div id="orderList"></div>
  </div>

  <div id="noOrders" class="no-orders" style="display: none;">
    <p style="text-align: center; color: #666; padding: 40px;">
      ê³ ê°ë‹˜ì˜ ì£¼ë¬¸ì´ ì¡°íšŒë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </p>
  </div>
</main>

<script>
// ì£¼ë¬¸ ì¡°íšŒ
function searchOrders(e) {
  e.preventDefault();
  
  const name = document.getElementById('customerName').value.trim();
  const phone = document.getElementById('customerPhone').value.trim();
  
  if (!name || !phone) {
    alert('ì´ë¦„ê³¼ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }

  // ì£¼ë¬¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
  const orders = JSON.parse(localStorage.getItem('giftCardOrders')) || [];
  
  // ì´ë¦„ê³¼ ì „í™”ë²ˆí˜¸ë¡œ í•„í„°ë§
  const matchedOrders = orders.filter(order => 
    order.customerName === name && order.customerPhone === phone
  );

  const resultsDiv = document.getElementById('orderResults');
  const noOrdersDiv = document.getElementById('noOrders');
  const orderListDiv = document.getElementById('orderList');

  if (matchedOrders.length === 0) {
    resultsDiv.style.display = 'none';
    noOrdersDiv.style.display = 'block';
  } else {
    noOrdersDiv.style.display = 'none';
    resultsDiv.style.display = 'block';
    
    // ì£¼ë¬¸ ëª©ë¡ ë Œë”ë§
    orderListDiv.innerHTML = matchedOrders.map(order => {
      const date = new Date(order.createdAt);
      const dateStr = date.toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      return `
        <div class="order-card">
          <div class="order-header">
            <div class="order-id">ì£¼ë¬¸ë²ˆí˜¸: ${order.id}</div>
            <div class="order-date">${dateStr}</div>
          </div>
          <div class="order-content">
            <div class="order-item">
              <span class="order-label">ìƒí’ˆê¶Œ:</span>
              <span class="order-value">${order.cardName}</span>
            </div>
            <div class="order-item">
              <span class="order-label">ê¸ˆì•¡:</span>
              <span class="order-value">â‚©${order.amount.toLocaleString()}</span>
            </div>
            <div class="order-item">
              <span class="order-label">ë§¤ì… ì‹œì„¸:</span>
              <span class="order-value">${order.rate}%</span>
            </div>
            <div class="order-item">
              <span class="order-label">ì˜ˆìƒ ì…ê¸ˆì•¡:</span>
              <span class="order-value highlight">â‚©${order.expectedAmount.toLocaleString()}</span>
            </div>
            <div class="order-item">
              <span class="order-label">ìƒíƒœ:</span>
              <span class="order-status ${getStatusClass(order.status)}">${getStatusText(order.status)}</span>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }

  // í–…í‹± í”¼ë“œë°±
  if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.HapticFeedback) {
    window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
  }
}

function getStatusText(status) {
  const statusMap = {
    'ëŒ€ê¸°ì¤‘': 'ëŒ€ê¸°ì¤‘',
    'ê²€ì¦ì¤‘': 'ê²€ì¦ì¤‘',
    'ì…ê¸ˆì™„ë£Œ': 'ì…ê¸ˆì™„ë£Œ',
    'ì™„ë£Œ': 'ì™„ë£Œ',
    'ì·¨ì†Œ': 'ì·¨ì†Œë¨'
  };
  return statusMap[status] || 'ëŒ€ê¸°ì¤‘';
}

function getStatusClass(status) {
  const classMap = {
    'ëŒ€ê¸°ì¤‘': 'pending',
    'ê²€ì¦ì¤‘': 'processing',
    'ì…ê¸ˆì™„ë£Œ': 'completed',
    'ì™„ë£Œ': 'completed',
    'ì·¨ì†Œ': 'cancelled'
  };
  return classMap[status] || 'pending';
}
</script>

<style>
.inquiry-form-container {
  max-width: 500px;
  margin: 0 auto;
  background: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  text-align: center;
}

.inquiry-form-container h2 {
  font-family: 'Poppins', sans-serif;
  font-size: 1.5em;
  color: #2c3e50;
  margin-bottom: 30px;
  line-height: 1.6;
}

.form-group {
  margin-bottom: 20px;
  text-align: left;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #2c3e50;
}

.form-input {
  width: 100%;
  padding: 12px;
  border: 2px solid #ddd;
  border-radius: 8px;
  font-size: 16px;
  font-family: inherit;
  box-sizing: border-box;
  transition: border-color 0.3s;
}

.form-input:focus {
  outline: none;
  border-color: #667eea;
}

.order-results {
  margin-top: 30px;
}

.order-results h3 {
  font-family: 'Poppins', sans-serif;
  font-size: 1.5em;
  color: #2c3e50;
  margin-bottom: 20px;
}

.order-list {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.order-card {
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.order-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  padding-bottom: 15px;
  border-bottom: 2px solid #eee;
}

.order-id {
  font-weight: 600;
  color: #667eea;
}

.order-date {
  font-size: 0.9em;
  color: #666;
}

.order-content {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.order-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.order-label {
  color: #666;
}

.order-value {
  font-weight: 600;
  color: #2c3e50;
}

.order-value.highlight {
  color: #667eea;
  font-size: 1.1em;
}

.order-status {
  padding: 4px 12px;
  border-radius: 15px;
  font-size: 0.85em;
  font-weight: 600;
}

.order-status.pending {
  background: #fff3e0;
  color: #e65100;
}

.order-status.processing {
  background: #e3f2fd;
  color: #1976d2;
}

.order-status.completed {
  background: #e8f5e9;
  color: #2e7d32;
}

.order-status.cancelled {
  background: #ffebee;
  color: #c62828;
}
</style>

</body>
</html>
