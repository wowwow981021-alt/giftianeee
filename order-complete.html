const lastOrderId = localStorage.getItem('lastOrderId');
const orders = JSON.parse(localStorage.getItem('giftCardOrders')) || [];
const order = orders.find(o => o.id === lastOrderId);

if (order) {
  // ==========================================
  // [신규 추가] 관리자 백엔드 서버로 데이터 전송
  // ==========================================
  if (!order.isSentToServer) {
    fetch('http://127.0.0.1:5000/api/submit-exchange', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(order)
    })
    .then(response => response.json())
    .then(result => {
      if(result.success) {
        order.isSentToServer = true; // 중복 전송 방지용 도장 쾅!
        localStorage.setItem('giftCardOrders', JSON.stringify(orders));
        console.log("관리자 페이지로 전송 성공!");
      }
    })
    .catch(err => console.error("서버 전송 에러:", err));
  }
  // ==========================================

  const infoDiv = document.getElementById('orderCompleteInfo');
  
  // ... (이 아래로는 기존에 있던 const date = new Date(order.createdAt); 코드가 그대로 이어집니다) ...
