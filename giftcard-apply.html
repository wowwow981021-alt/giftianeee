<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ìƒí’ˆê¶Œ í˜„ê¸ˆêµí™˜ ì‹ ì²­ | ì´ì•ˆí‹°ì¼“</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    (function() {
      function forceExpand() {
        if (window.Telegram && window.Telegram.WebApp) {
          try {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
            if (window.Telegram.WebApp.viewportHeight) {
              window.Telegram.WebApp.expand();
            }
          } catch (e) {
            console.error('í…”ë ˆê·¸ë¨ WebApp í™•ì¥ ì˜¤ë¥˜:', e);
          }
        }
      }
      forceExpand();
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', forceExpand);
      }
      setTimeout(forceExpand, 100);
      setTimeout(forceExpand, 500);
      window.addEventListener('load', forceExpand);
    })();
  </script>
</head>
<body>

<header class="shop-header">
  <div class="header-container">
    <div class="header-left">
      <h1 class="shop-logo">ìƒí’ˆê¶Œ í˜„ê¸ˆêµí™˜ ì‹ ì²­</h1>
    </div>
    <div class="header-right">
      <a href="index.html" class="cart-icon-link">
        <span class="cart-icon">ğŸ </span>
      </a>
    </div>
  </div>
</header>

<main class="main-content" style="padding: 20px;">
  <div class="apply-form-container">
    <h2>ìƒí’ˆê¶Œ ì„ íƒ</h2>
    <p style="color: #666; margin-bottom: 20px;">íŒë§¤í•˜ì‹¤ ìƒí’ˆê¶Œì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
    
    <div id="selectedCardInfo" class="selected-card-info" style="display: none;">
      <div class="info-card">
        <h3 id="selectedCardName"></h3>
        <p>ë§¤ì… ì‹œì„¸: <span id="selectedCardRate" style="font-weight: bold; color: #667eea;"></span>%</p>
      </div>
    </div>

    <div class="gift-card-selector">
      <label>ìƒí’ˆê¶Œ ì¢…ë¥˜</label>
      <select id="giftCardType" class="form-select" onchange="updateSelectedCard()">
        <option value="">ìƒí’ˆê¶Œì„ ì„ íƒí•˜ì„¸ìš”</option>
        <option value="cul_1">ì»¬ì³ëœë“œ ìƒí’ˆê¶Œ (90.00%)</option>
        <option value="cul_ex">ì»¬ì³ëœë“œ êµí™˜ê¶Œ (90.00%)</option>
        <option value="culture">ë¬¸í™”ìƒí’ˆê¶Œ (90.00%)</option>
        <option value="culture_ex">ë¬¸í™” êµí™˜ê¶Œ (90.00%)</option>
        <option value="book">ë¶ì•¤ë¼ì´í”„ (90.00%)</option>
        <option value="book_ex">ë¶ì•¤ë¼ì´í”„ êµí™˜ê¶Œ (90.00%)</option>
        <option value="tincash">í‹´ìºì‹œ (90.00%)</option>
        <option value="lotte">ë¡¯ë°ëª¨ë°”ì¼ êµí™˜ê¶Œ (93.00%)</option>
        <option value="google">êµ¬ê¸€ êµí™˜ê¶Œ (90.00%)</option>
        <option value="starbucks_e">ìŠ¤íƒ€ë²…ìŠ¤ eì¹´ë“œ êµí™˜ê¶Œ (85.00%)</option>
        <option value="starbucks_24">ìŠ¤íƒ€ë²…ìŠ¤ ê¸°í”„íŠ¸ì¹´ë“œ(24ìë¦¬) (85.00%)</option>
        <option value="tincash_ex">í‹´ìºì‹œ êµí™˜ê¶Œ (90.00%)</option>
        <option value="shinsegae">ì‹ ì„¸ê³„ëª¨ë°”ì¼ìƒí’ˆê¶Œ (93.00%)</option>
      </select>
    </div>

    <hr style="margin: 30px 0;">

    <h3>ìƒí’ˆê¶Œ ì •ë³´ ì…ë ¥</h3>
    
    <div class="form-group">
      <label>ìƒí’ˆê¶Œ ê¸ˆì•¡</label>
      <input type="number" id="giftCardAmount" class="form-input" placeholder="ì˜ˆ: 50000" min="1000" step="1000" oninput="calculateAmount()">
      <small style="color: #666;">ìµœì†Œ 1,000ì› ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.</small>
    </div>

    <div class="form-group">
      <label>ìƒí’ˆê¶Œ ë²ˆí˜¸</label>
      <textarea id="giftCardNumber" class="form-textarea" placeholder="ìƒí’ˆê¶Œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì—¬ëŸ¬ ê°œì¼ ê²½ìš° ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)" rows="5"></textarea>
      <small style="color: #666;">ì—¬ëŸ¬ ê°œì˜ ìƒí’ˆê¶Œì„ ë“±ë¡í•  ê²½ìš° ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„í•´ì£¼ì„¸ìš”.</small>
    </div>

    <div class="amount-calculation" id="amountCalculation" style="display: none;">
      <div class="calc-item">
        <span>ìƒí’ˆê¶Œ ê¸ˆì•¡:</span>
        <span id="calcOriginal">â‚©0</span>
      </div>
      <div class="calc-item">
        <span>ë§¤ì… ì‹œì„¸:</span>
        <span id="calcRate">0%</span>
      </div>
      <div class="calc-item calc-total">
        <span>ì˜ˆìƒ ì…ê¸ˆ ê¸ˆì•¡:</span>
        <span id="calcTotal">â‚©0</span>
      </div>
    </div>

    <hr style="margin: 30px 0;">

    <h3>ì…ê¸ˆ ì •ë³´</h3>
    
    <div class="form-group">
      <label>ì˜ˆê¸ˆì£¼</label>
      <input type="text" id="accountHolder" class="form-input" placeholder="ì˜ˆê¸ˆì£¼ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
    </div>

    <div class="form-group">
      <label>ì€í–‰</label>
      <select id="bankName" class="form-select" required>
        <option value="">ì€í–‰ì„ ì„ íƒí•˜ì„¸ìš”</option>
        <option value="kb">KBêµ­ë¯¼ì€í–‰</option>
        <option value="shinhan">ì‹ í•œì€í–‰</option>
        <option value="woori">ìš°ë¦¬ì€í–‰</option>
        <option value="hana">í•˜ë‚˜ì€í–‰</option>
        <option value="nh">NHë†í˜‘ì€í–‰</option>
        <option value="ibk">IBKê¸°ì—…ì€í–‰</option>
        <option value="keb">KEBí•˜ë‚˜ì€í–‰</option>
        <option value="kakao">ì¹´ì¹´ì˜¤ë±…í¬</option>
        <option value="toss">í† ìŠ¤ë±…í¬</option>
      </select>
    </div>

    <div class="form-group">
      <label>ê³„ì¢Œë²ˆí˜¸</label>
      <input type="text" id="accountNumber" class="form-input" placeholder="ê³„ì¢Œë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
    </div>

    <hr style="margin: 30px 0;">

    <h3>ì—°ë½ì²˜ ì •ë³´</h3>
    
    <div class="form-group">
      <label>ì´ë¦„</label>
      <input type="text" id="customerName" class="form-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
    </div>

    <div class="form-group">
      <label>íœ´ëŒ€í° ë²ˆí˜¸</label>
      <input type="tel" id="customerPhone" class="form-input" placeholder="010-0000-0000" required>
    </div>

    <div class="form-group">
      <label>ìš”ì²­ì‚¬í•­ (ì„ íƒ)</label>
      <textarea id="memo" class="form-textarea" placeholder="ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì…ë ¥í•´ì£¼ì„¸ìš”" rows="3"></textarea>
    </div>

    <div class="form-submit">
      <button type="button" class="btn-primary" onclick="submitApplication()" style="width: 100%; padding: 18px; font-size: 1.2em;">
        ì‹ ì²­í•˜ê¸°
      </button>
    </div>

    <div class="notice-box" style="margin-top: 30px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
      <h4 style="margin-top: 0;">âš ï¸ ì£¼ì˜ì‚¬í•­</h4>
      <ul style="margin: 10px 0; padding-left: 20px;">
        <li>ìƒí’ˆê¶Œ ë²ˆí˜¸ëŠ” ì •í™•í•˜ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.</li>
        <li>ì…ê¸ˆì€ ìƒí’ˆê¶Œ ê²€ì¦ ì™„ë£Œ í›„ 1~2ì¼ ë‚´ ì²˜ë¦¬ë©ë‹ˆë‹¤.</li>
        <li>ìƒí’ˆê¶Œ ê¸ˆì•¡ê³¼ ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ê²½ìš° ê±°ë˜ê°€ ì·¨ì†Œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
        <li>ë¬¸ì˜ì‚¬í•­ì€ ê³ ê°ì„¼í„°ë¡œ ì—°ë½ì£¼ì„¸ìš”.</li>
      </ul>
    </div>
  </div>
</main>

<script>
// ìƒí’ˆê¶Œ ì •ë³´
const giftCardTypes = {
  'cul_1': { name: 'ì»¬ì³ëœë“œ ìƒí’ˆê¶Œ', rate: 90.00 },
  'cul_ex': { name: 'ì»¬ì³ëœë“œ êµí™˜ê¶Œ', rate: 90.00 },
  'culture': { name: 'ë¬¸í™”ìƒí’ˆê¶Œ', rate: 90.00 },
  'culture_ex': { name: 'ë¬¸í™” êµí™˜ê¶Œ', rate: 90.00 },
  'book': { name: 'ë¶ì•¤ë¼ì´í”„', rate: 90.00 },
  'book_ex': { name: 'ë¶ì•¤ë¼ì´í”„ êµí™˜ê¶Œ', rate: 90.00 },
  'tincash': { name: 'í‹´ìºì‹œ', rate: 90.00 },
  'lotte': { name: 'ë¡¯ë°ëª¨ë°”ì¼ êµí™˜ê¶Œ', rate: 93.00 },
  'google': { name: 'êµ¬ê¸€ êµí™˜ê¶Œ', rate: 90.00 },
  'starbucks_e': { name: 'ìŠ¤íƒ€ë²…ìŠ¤ eì¹´ë“œ êµí™˜ê¶Œ', rate: 85.00 },
  'starbucks_24': { name: 'ìŠ¤íƒ€ë²…ìŠ¤ ê¸°í”„íŠ¸ì¹´ë“œ(24ìë¦¬)', rate: 85.00 },
  'tincash_ex': { name: 'í‹´ìºì‹œ êµí™˜ê¶Œ', rate: 90.00 },
  'shinsegae': { name: 'ì‹ ì„¸ê³„ëª¨ë°”ì¼ìƒí’ˆê¶Œ', rate: 93.00 }
};

// ì„ íƒí•œ ìƒí’ˆê¶Œ ì—…ë°ì´íŠ¸
function updateSelectedCard() {
  const type = document.getElementById('giftCardType').value;
  const infoDiv = document.getElementById('selectedCardInfo');
  
  if (type && giftCardTypes[type]) {
    const card = giftCardTypes[type];
    document.getElementById('selectedCardName').textContent = card.name;
    document.getElementById('selectedCardRate').textContent = card.rate.toFixed(2) + '%';
    infoDiv.style.display = 'block';
    calculateAmount();
  } else {
    infoDiv.style.display = 'none';
  }
}

// ê¸ˆì•¡ ê³„ì‚°
function calculateAmount() {
  const type = document.getElementById('giftCardType').value;
  const amount = parseInt(document.getElementById('giftCardAmount').value) || 0;
  const calcDiv = document.getElementById('amountCalculation');
  
  if (type && amount > 0 && giftCardTypes[type]) {
    const card = giftCardTypes[type];
    const rate = card.rate / 100;
    const total = Math.floor(amount * rate);
    
    document.getElementById('calcOriginal').textContent = 'â‚©' + amount.toLocaleString();
    document.getElementById('calcRate').textContent = card.rate.toFixed(2) + '%';
    document.getElementById('calcTotal').textContent = 'â‚©' + total.toLocaleString();
    calcDiv.style.display = 'block';
  } else {
    calcDiv.style.display = 'none';
  }
}

// ì‹ ì²­ì„œ ì œì¶œ
function submitApplication() {
  const type = document.getElementById('giftCardType').value;
  const amount = parseInt(document.getElementById('giftCardAmount').value);
  const cardNumber = document.getElementById('giftCardNumber').value.trim();
  const accountHolder = document.getElementById('accountHolder').value.trim();
  const bankName = document.getElementById('bankName').value;
  const accountNumber = document.getElementById('accountNumber').value.trim();
  const customerName = document.getElementById('customerName').value.trim();
  const customerPhone = document.getElementById('customerPhone').value.trim();
  const memo = document.getElementById('memo').value.trim();

  // ìœ íš¨ì„± ê²€ì‚¬
  if (!type) {
    alert('ìƒí’ˆê¶Œ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (!amount || amount < 1000) {
    alert('ìƒí’ˆê¶Œ ê¸ˆì•¡ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”. (ìµœì†Œ 1,000ì›)');
    return;
  }
  
  if (!cardNumber) {
    alert('ìƒí’ˆê¶Œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (!accountHolder || !bankName || !accountNumber) {
    alert('ì…ê¸ˆ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (!customerName || !customerPhone) {
    alert('ì—°ë½ì²˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }

  // ì‹ ì²­ ì •ë³´ ì €ì¥
  const application = {
    id: 'GC' + Date.now(),
    type,
    cardName: giftCardTypes[type].name,
    rate: giftCardTypes[type].rate,
    amount,
    cardNumber,
    accountHolder,
    bankName,
    accountNumber,
    customerName,
    customerPhone,
    memo,
    status: 'ëŒ€ê¸°ì¤‘',
    createdAt: new Date().toISOString(),
    expectedAmount: Math.floor(amount * (giftCardTypes[type].rate / 100))
  };

  // ê¸°ì¡´ ì£¼ë¬¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
  let orders = JSON.parse(localStorage.getItem('giftCardOrders')) || [];
  orders.push(application);
  localStorage.setItem('giftCardOrders', JSON.stringify(orders));

  // ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€ë¡œ ì´ë™
  localStorage.setItem('lastOrderId', application.id);
  window.location.href = 'order-complete.html';
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì„ íƒëœ ìƒí’ˆê¶Œ ì •ë³´ í™•ì¸
document.addEventListener('DOMContentLoaded', function() {
  const selectedCard = JSON.parse(localStorage.getItem('selectedGiftCard'));
  if (selectedCard) {
    document.getElementById('giftCardType').value = selectedCard.type;
    updateSelectedCard();
    localStorage.removeItem('selectedGiftCard');
  }
});
</script>

<style>
.apply-form-container {
  max-width: 600px;
  margin: 0 auto;
  background: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.selected-card-info {
  margin-bottom: 20px;
}

.info-card {
  padding: 15px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 10px;
}

.info-card h3 {
  margin: 0 0 10px 0;
  font-size: 1.3em;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #2c3e50;
}

.form-input,
.form-select,
.form-textarea {
  width: 100%;
  padding: 12px;
  border: 2px solid #ddd;
  border-radius: 8px;
  font-size: 16px;
  font-family: inherit;
  box-sizing: border-box;
  transition: border-color 0.3s;
}

.form-input:focus,
.form-select:focus,
.form-textarea:focus {
  outline: none;
  border-color: #667eea;
}

.form-group small {
  display: block;
  margin-top: 5px;
  font-size: 0.85em;
}

.amount-calculation {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 10px;
  margin-top: 20px;
}

.calc-item {
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
  border-bottom: 1px solid #ddd;
}

.calc-item:last-child {
  border-bottom: none;
}

.calc-total {
  font-size: 1.3em;
  font-weight: bold;
  color: #667eea;
  margin-top: 10px;
  padding-top: 15px;
  border-top: 2px solid #667eea;
}

.form-submit {
  margin-top: 30px;
}

.notice-box h4 {
  color: #856404;
}

.notice-box ul {
  color: #856404;
}

.notice-box li {
  margin: 5px 0;
}
</style>

</body>
</html>
