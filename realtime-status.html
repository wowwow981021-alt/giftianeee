<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ì‹¤ì‹œê°„ ì§„í–‰ í˜„í™© | ì´ì•ˆí‹°ì¼“</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    (function() {
      function forceExpand() {
        if (window.Telegram && window.Telegram.WebApp) {
          try {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
            if (window.Telegram.WebApp.viewportHeight) {
              window.Telegram.WebApp.expand();
            }
          } catch (e) {
            console.error('í…”ë ˆê·¸ë¨ WebApp í™•ì¥ ì˜¤ë¥˜:', e);
          }
        }
      }
      forceExpand();
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', forceExpand);
      }
      setTimeout(forceExpand, 100);
      setTimeout(forceExpand, 500);
      window.addEventListener('load', forceExpand);
    })();
  </script>
</head>
<body>

<header class="shop-header">
  <div class="header-container">
    <div class="header-left">
      <h1 class="shop-logo">ì‹¤ì‹œê°„ ì§„í–‰ í˜„í™©</h1>
    </div>
    <div class="header-right">
      <a href="index.html" class="cart-icon-link">
        <span class="cart-icon">ğŸ </span>
      </a>
    </div>
  </div>
</header>

<main class="main-content" style="padding: 20px;">
  <div class="status-header">
    <h2>ìµœê·¼ ë§¤ì… í˜„í™©ì…ë‹ˆë‹¤</h2>
    <p style="color: #666; margin-bottom: 20px;">ì‹¤ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ëŠ” ë§¤ì… í˜„í™©ì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </div>

  <div id="statusList" class="status-list">
    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
  </div>

  <div class="refresh-btn-container">
    <button class="btn-secondary" onclick="refreshStatus()" style="width: 100%; padding: 15px; margin-top: 20px;">
      ğŸ”„ ìƒˆë¡œê³ ì¹¨
    </button>
  </div>
</main>

<script>
// ìƒ˜í”Œ ë§¤ì… í˜„í™© ë°ì´í„°
const sampleStatuses = [
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 1, amount: 50000, customer: 'ê°•*ë¬¸', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 1, amount: 5000, customer: 'ë°•*ì§€', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 3, amount: 25000, customer: 'ë„*ì§„', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 3, amount: 150000, customer: 'ì´*ì¡°', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'ë¬¸í™”ìƒí’ˆê¶Œ(18í•€)', count: 4, amount: 40000, customer: 'ì´*ì§„', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ­' },
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 4, amount: 200000, customer: 'ê¹€*íƒœ', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 1, amount: 30000, customer: 'ì´*ì¡°', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'í‹´ìºì‹œ', count: 1, amount: 50000, customer: 'í‘œ*í™˜', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ’³' },
  { cardName: 'ì»¬ì³ëœë“œ êµí™˜ê¶Œ', count: 1, amount: 30000, customer: 'í•˜*ì„', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸŸï¸' },
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 6, amount: 300000, customer: 'ì›*í›ˆ', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'ë¡¯ë°ëª¨ë°”ì¼ êµí™˜ê¶Œ', count: 1, amount: 200000, customer: 'ê¹€*êµ¬', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸª' },
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 2, amount: 60000, customer: 'ê³½*ì •', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 6, amount: 300000, customer: 'ê¹€*êµ¬', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 4, amount: 200000, customer: 'ì›*í›ˆ', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 7, amount: 350000, customer: 'ê³½*ì •', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'ë¡¯ë°ëª¨ë°”ì¼ êµí™˜ê¶Œ', count: 2, amount: 600000, customer: 'ë¬¸*ìˆ˜', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸª' },
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 3, amount: 90000, customer: 'ì¡°*í›ˆ', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'ë¡¯ë°ëª¨ë°”ì¼ êµí™˜ê¶Œ', count: 1, amount: 50000, customer: 'ë°•*ìš°', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸª' },
  { cardName: 'ì»¬ì³ëœë“œ(16í•€)', count: 2, amount: 100000, customer: 'ì´*ì§€', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸ«' },
  { cardName: 'ë¡¯ë°ëª¨ë°”ì¼ êµí™˜ê¶Œ', count: 2, amount: 600000, customer: 'ì‹ *ì² ', status: 'ì…ê¸ˆì™„ë£Œ', icon: 'ğŸª' }
];

// ì‹¤ì œ ì£¼ë¬¸ ë°ì´í„°ì™€ í•©ì¹˜ê¸°
function getStatusList() {
  const orders = JSON.parse(localStorage.getItem('giftCardOrders')) || [];
  const statusList = [];
  
  // ì‹¤ì œ ì£¼ë¬¸ ë°ì´í„° ë³€í™˜
  orders.forEach(order => {
    statusList.push({
      cardName: order.cardName,
      count: 1,
      amount: order.amount,
      customer: order.customerName ? order.customerName.replace(/(?<=.{1})./g, '*') : 'ê³ *ê°',
      status: getStatusText(order.status),
      icon: getCardIcon(order.type)
    });
  });
  
  // ìƒ˜í”Œ ë°ì´í„°ì™€ í•©ì¹˜ê¸°
  return [...statusList, ...sampleStatuses].slice(0, 20);
}

function getStatusText(status) {
  const statusMap = {
    'ëŒ€ê¸°ì¤‘': 'ê²€ì¦ì¤‘',
    'ê²€ì¦ì¤‘': 'ê²€ì¦ì¤‘',
    'ì…ê¸ˆì™„ë£Œ': 'ì…ê¸ˆì™„ë£Œ',
    'ì™„ë£Œ': 'ì…ê¸ˆì™„ë£Œ',
    'ì·¨ì†Œ': 'ì·¨ì†Œë¨'
  };
  return statusMap[status] || 'ê²€ì¦ì¤‘';
}

function getCardIcon(type) {
  const iconMap = {
    'cul_1': 'ğŸ«',
    'cul_ex': 'ğŸŸï¸',
    'culture': 'ğŸ­',
    'culture_ex': 'ğŸ¨',
    'book': 'ğŸ“š',
    'book_ex': 'ğŸ“–',
    'tincash': 'ğŸ’³',
    'lotte': 'ğŸª',
    'google': 'ğŸ”',
    'starbucks_e': 'â˜•',
    'starbucks_24': 'â˜•',
    'tincash_ex': 'ğŸ’³',
    'shinsegae': 'ğŸ›ï¸'
  };
  return iconMap[type] || 'ğŸ«';
}

// í˜„í™© ëª©ë¡ ë Œë”ë§
function renderStatusList() {
  const statusList = getStatusList();
  const container = document.getElementById('statusList');
  
  if (!container) return;
  
  if (statusList.length === 0) {
    container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ë§¤ì… í˜„í™©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
    return;
  }
  
  container.innerHTML = statusList.map(status => `
    <div class="status-item">
      <div class="status-icon">${status.icon}</div>
      <div class="status-info">
        <div class="status-card-name">${status.cardName} ${status.count}ë§¤${status.amount.toLocaleString()}ì›</div>
        <div class="status-customer">${status.customer}ë‹˜</div>
      </div>
      <div class="status-badge ${status.status === 'ì…ê¸ˆì™„ë£Œ' ? 'completed' : 'pending'}">
        ${status.status}
      </div>
    </div>
  `).join('');
}

// ìƒˆë¡œê³ ì¹¨
function refreshStatus() {
  renderStatusList();
  // í–…í‹± í”¼ë“œë°±
  if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.HapticFeedback) {
    window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
  }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ë Œë”ë§
document.addEventListener('DOMContentLoaded', function() {
  renderStatusList();
  // 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
  setInterval(renderStatusList, 30000);
});
</script>

<style>
.status-header {
  text-align: center;
  margin-bottom: 30px;
}

.status-header h2 {
  font-family: 'Poppins', sans-serif;
  font-size: 1.8em;
  color: #2c3e50;
  margin-bottom: 10px;
}

.status-list {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.status-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: transform 0.2s, box-shadow 0.2s;
}

.status-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.status-icon {
  font-size: 2em;
  flex-shrink: 0;
}

.status-info {
  flex: 1;
}

.status-card-name {
  font-weight: 600;
  color: #2c3e50;
  margin-bottom: 5px;
}

.status-customer {
  font-size: 0.9em;
  color: #666;
}

.status-badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.85em;
  font-weight: 600;
  flex-shrink: 0;
}

.status-badge.completed {
  background: #e8f5e9;
  color: #2e7d32;
}

.status-badge.pending {
  background: #fff3e0;
  color: #e65100;
}
</style>

</body>
</html>
